%description:
Creates an omnet++ environment and runs testMain() function from TestMain.cc

%includes:
#include "gtest/gtest.h"
#include "TestUtil.h"
#include "TestMain.h"

cModule* netModule;

%activity:
    netModule = this;
    //std::cout << "assigning netModule value: " <<
    //    static_cast<void*>(netModule) << std::endl;
    int argc = 1;
    char* argv[5] = {"main"};
    testMain(argc, argv);

%inifile: homaTransportConfig.ini
    [General]
    network = Test
    cmdenv-express-mode = false

    **.transportSchemeType = "${transportSchemeType = HomaTransport}"
    **.nicLinkSpeed = 10Gbps
    **.isRoundRobinScheduler = false
    **.useUnschRateInScheduler = false
    **.prioLevels = 16
    **.prioResolverPrioLevels = 8
    **.adaptiveSchedPrioLevels = 8 
    **.numSendersToKeepGranted = 8
    **.localPort = 2222
    **.destPort = 2222
    **.transportType = "HomaTransport"

    **.RTT = ${RTT=0x2710} ##10000B is the min RTT in bytes
    **.maxOutstandingRecvBytes = ${maxOutstandingRecvBytes = $RTT} B
    **.unschedPrioResolutionMode = "${unschedPrioResolutionMode = STATIC_CBF_GRADUATED}"
    **.unschedPrioUsageWeight = ${unschedPrioUsageWeight = 1}
    **.cbfCapMsgSize = "${cbfCapMsgSize = $RTT}"
    **.boostTailBytesPrio = "${boostTailBytesPrio = $RTT}"
    **.defaultReqBytes = ${defaultReqBytes = 1442 }B
    **.defaultUnschedBytes = ${defaultUnschedBytes = 7886 }B
    **.senderScheme = "${senderScheme = SRBF}" 
    **.accountForGrantTraffic = ${accountForGrantTraffic = true}
    **.linkCheckBytes = 1600B
    **.workloadType = "${workloadType = GOOGLE_ALL_RPC}"
